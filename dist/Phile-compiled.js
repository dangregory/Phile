(function(h){function l(a){var b=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0"),e;e=a.url;var d;if(a.params)for(d in a.params)e+=(-1===e.indexOf("?")?"?":"\x26")+d+"\x3d"+encodeURIComponent(a.params[d]);e=[a.method||"GET",e,a.async];a.username&&a.password&&e.push(a.username,a.password);b.open.apply(b,e);b.onreadystatechange=function(){var d=a.scope||null;switch(this.readyState){case 0:"function"===typeof a.aborted&&a.aborted.call(d,a,this);break;case 4:if(200===b.status){var e,
c=b.getResponseHeader("Content-Type");if(c){var k=c.indexOf(";charset\x3d");-1!==k&&(c.substr(k+9),c=c.substr(0,k))}try{switch(c){case "application/json":e=JSON.parse(b.responseText);break;case "application/javascript":case "text/javascript":e=eval(b.responseText);break;case "application/xml":case "text/xml":e=b.responseXML;break;default:e=b.responseText}"function"===typeof a.success&&a.success.call(d,a,this,e)}catch(h){"function"===typeof a.failure&&a.failure.call(d,a,this,h)}}else"function"===typeof a.failure&&
a.failure.call(d,a,this,{type:"http",status:b.status,statusText:b.statusText,responseText:b.responseText})}};if(a.headers)for(d in a.headers)b.setRequestHeader(d,a.headers[d]);d=null;if(a.data)if("object"===typeof a.data&&null!==d){d="";for(var c in a.data)d+=c+"\x3d"+a.data[c]}else d=a.data;b.send(d);return b}var c=function(a){var b,e={};if(a)for(b in a)e[b]=a[b];a=c.defaultOptions;for(b in a)"undefined"===typeof e[b]&&(e[b]=a[b]);this.options=e};c.defaultOptions={requestTimeout:3E4,async:!0,webapp:"pentaho",
mountPoint:"api",dirService:"repo/dirs",fileService:"repo/files",sessionService:"session"};c.separator="/";c.createFileComparator=function(a){return function(b,e){b.file&&(b=b.file);e.file&&(e=e.file);var d,c,f,g;for(d in a){c=a[d]||{};f=b[d];g=e[d];"function"===typeof c.convert&&(f=c.convert(f),g=c.convert(g));c=c.direction||1;if(f>g)return 1*c;if(f<g)return-1*c}return 0}};c.compareFilesByPathCS=c.createFileComparator({path:null});c.compareFilesByOriginalPathAndName=c.createFileComparator({originalParentFolderPath:null,
name:null});c.compareFilesByTitleCS=c.createFileComparator({folder:{direction:-1},title:null});c.compareFilesByTitleCI=c.createFileComparator({folder:{direction:-1},title:{convert:function(a){return a.toUpperCase()}}});c.prototype={getUrl:function(a,b,c){var d=this.options;a=a||d.fileService;a="/"+d.webapp+"/"+d.mountPoint+"/"+a;b&&(b="function"===typeof b.join?b.join(":"):b.replace(/\//g,":"),(b=encodeURI(b))&&(a+="/"+b));c&&(a+="/"+c);return a},request:function(a){var b=this.options;a.url=this.getUrl(a.service||
b.fileService,a.path,a.action);return l(a)},getChildren:function(a){if(a.file){if("true"!==String(a.file.folder))throw Error("File must be of the type folder");a.path=a.file.path}a.service=this.options.fileService;a.path||(a.path="");a.params||(a.params={});"undefined"!==typeof a.showHidden&&(a.params.showHidden=Boolean(a.showHidden));"undefined"!==typeof a.filter&&(a.params.filter=String(a.filter));a.headers||(a.headers={});a.headers.Accept||(a.headers.Accept="application/json");"undefined"===typeof a.action&&
(a.action="children");a.method="GET";return this.request(a)},getTree:function(a){a.params||(a.params={});var b=a.depth||1;a.params.depth||(a.params.depth=b);a.action="tree";return this.getChildren(a)},getTrash:function(a){a||(a={});a.params||(a.params={});a.action="deleted";return this.getChildren(a)},getContents:function(a){if(a.file){if("true"===String(a.file.folder))throw Error("File must not be of the type folder");a.path=a.file.path}a.service=this.options.fileService;a.action=null;a.method="GET";
return this.request(a)},getUrlForDownload:function(a){a.path&&(a=a.path);return this.getUrl(this.options.fileService,a,"download")},getProperties:function(a){a.file&&(a.path=a.file.path);a.service=this.options.fileService;a.headers||(a.headers={});a.headers.Accept||(a.headers.Accept="application/json");a.action="properties";a.method="GET";return this.request(a)},_create:function(a){a.method="PUT";var b,c;a.success&&(b=a.success,c=a.scope||null);a.success=function(a,k,f){var g=window.top,h=g.mantle_fireEvent;
"function"===typeof h&&(h.call(g,"GenericEvent",{eventSubType:"RefreshBrowsePerspectiveEvent"}),h.call(g,"GenericEvent",{eventSubType:"RefreshCurrentFolderEvent"}));"function"===typeof b&&b.call(c,a,k,f)};return this.request(a)},createDirectory:function(a){a.file&&(a.path=a.file.path);a.service=this.options.dirService;return this._create(a)},saveFile:function(a){a.file&&(a.path=a.file.path);a.service=this.options.fileService;return this._create(a)},getUserHomeDir:function(a){a.service=this.options.sessionService;
a.user?(a.path="workspaceDirForUser",a.action=a.user):(delete a.path,a.action="userWorkspaceDir");return this.request(a)},discard:function(a){var b=a.file?a.file.id:a.id;if(b)a.id=b,delete a.path,a.service=this.options.fileService,a.method="PUT",a.action=!0===a.permanent?"deletepermanent":"delete",a.data=a.id,this.request(a);else if(a.path){var c=this;this.getProperties({path:a.path,success:function(b,k,f){a.id=f.id;c.discard(a)},failure:function(b,c,e){"function"===typeof a.failure&&a.failure.call(a.scope,
b,c,e)}})}},restore:function(a){a.service=this.options.fileService;a.action="restore";a.method="PUT";a.data=a.file?a.file.id:a.id;this.request(a)},rename:function(a){a.service=this.options.fileService;a.action="rename";a.method="PUT";a.file&&(a.path=a.file.path);a.params||(a.params={});a.params.newName=a.newName;a.headers||(a.headers={});a.headers.Accept||(a.headers.Accept="application/xml");this.request(a)}};"function"===typeof define&&define.amd?define(function(){return c}):h.Phile=c;return c})("undefined"===
typeof exports?window:exports);